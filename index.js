var LT;(()=>{"use strict";function e(e){return Array.from((new TextEncoder).encode(e),(e=>e.toString(16).padStart(2,"0"))).join("")}function t(e){const t=new Uint8Array(e.length/2);for(let n=0;n!==t.length;n++)t[n]=parseInt(e.substr(2*n,2),16);return(new TextDecoder).decode(t)}function n(e){return e&&e.length>14?e.substring(0,5)+"..."+e.substring(e.length-5):e}function a(e){if(navigator.clipboard)return navigator.clipboard.writeText(e).then((function(){}),(function(e){return console.log("ERROR copyToClipboard(): "+e),!1})),!0;let t;var n=document.createElement("textarea");n.value=e,n.style.top="0",n.style.left="0",n.style.position="fixed",document.body.appendChild(n),n.focus(),n.select();try{document.execCommand("copy"),t=!0}catch(e){console.log("ERROR copyToClipboard(): "+e)}return document.body.removeChild(n),t}function s(e){return/^(tz|KT)[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{34}$/.test(String(e))}const o=new beacon.DAppClient({name:"NFTez"}),i="KT1TRuN4Uc4ai6ZjWRjtedX9ChmfcfvxfBXt";let r="ghostnet",c="";async function l(e){try{let t=await fetch("https://api."+r+".tzkt.io/v1/contracts/"+e+"/bigmaps/metadata/keys?key=content&select=value");if(t.ok)return(await t.json())[0];console.log("ERROR getCollection(): can't get collection")}catch(e){console.log("ERRROR getCollection(): "+JSON.stringify(e))}}async function d(e,t){let n="sort.desc=id&active=true&select=key,value"+(e?"&value.token.address="+e:"")+(t?"&value.token.id="+t:"");try{let e=await fetch("https://api."+r+".tzkt.io/v1/contracts/"+i+"/bigmaps/offers/keys?"+n);if(e.ok){let t=await e.json();if(t&&t.length>0){let e=null;for(let n of t)n.value.seller!==c&&(e?Number(e.value.price)>=Number(n.value.price)&&(e=n):e=n);return e}}else console.log("ERROR getBestOffer(): can't get best offer")}catch(e){console.log("ERRROR getBestOffer(): "+e+JSON.stringify(e))}}async function m(e,t){let n="limit=1&select=account.address as account,token,balance,firstTime&token.contract="+e+"&token.tokenid="+t;try{let e=await fetch("https://api."+r+".tzkt.io/v1/tokens/balances?"+n+"&account="+c);if(e.ok){let t=await e.json();if(t.length>0)return t[0];{let e=await fetch("https://api."+r+".tzkt.io/v1/tokens/balances?"+n);if(e.ok){if(t=await e.json(),t.length>0)return t[0].account=c,t[0].balance=0,t[0]}else console.log("ERROR getToken(): can't get token")}}else console.log("ERROR getToken(): can't get token balance")}catch(e){console.log("ERRROR getToken(): "+JSON.stringify(e))}}const u={message:"The address is copied",type:"is-success"};function g(){document.querySelectorAll(".js-page").forEach((function(e){e.classList.add("is-hidden")}))}async function y(){let e=document.getElementById("dListings"),t=new URLSearchParams(window.location.search),n=t.get("seller"),a=t.get("minprice"),s=t.get("maxprice"),o=t.get("cid"),c=t.get("tid"),l=0,d=await async function(e,t,n,a,s,o,c){let l="sort.desc=id&active=true&select=key,value&limit=20"+(c?"&offset="+c:"")+(e?"&value.seller="+e:"")+(t?"&value.price.ge="+t:"")+(n?"&value.price.le="+n:"")+(a?"&value.token.address="+a:"")+(s?"&value.token.id="+s:"");try{let e=await fetch("https://api."+r+".tzkt.io/v1/contracts/"+i+"/bigmaps/offers/keys?"+l);if(e.ok)return await e.json();console.log("ERROR getOffers(): can't get offers")}catch(e){console.log("ERRROR getOffers(): "+JSON.stringify(e))}}(n,a,s,o,c,0,E);for(let t of d){l++;let n=await f(t);e.append(n)}let m=document.getElementById("dMoreListings");l<20?m.classList.add("is-hidden"):m.classList.remove("is-hidden"),m.classList.remove("is-loading"),0===(E+=l)&&(e.textContent="There are no listings matching these criteria.")}async function f(e){let t,a=new URL(window.location);const s=document.getElementById("t-listing").content.cloneNode(!0);let r=(await m(e.value.token.address,e.value.token.id)).token,l=r.metadata?.name;t=s.querySelector(".js-name"),t.innerText=l||"";let d=s.querySelector(".js-creators"),u=s.querySelector(".js-creator");l=r.metadata?.creators;try{l=JSON.parse(l);for(let e=0;e<l.length;e++)t=u.cloneNode(!0),t.setAttribute("href",a.origin+a.pathname+"?cmd=tokens&creator="+l[e]),t.append(document.createTextNode(n(l[e]))),e>0&&d.append(document.createTextNode(", ")),t.classList.remove("is-hidden"),d.append(t)}catch(e){s.querySelector(".js-creators").innerText=""}if(l=new Date(Date.parse(e.value.time_start)).toLocaleString(),t=s.querySelector(".js-start-time"),t.innerText=l||"",l=e.value.time_expiry?new Date(Date.parse(e.value.time_expiry))?.toLocaleString():"...",t=s.querySelector(".js-expiry-time"),t.innerText=l||"",l=e.value.amount,t=s.querySelector(".js-amount"),t.innerText=l||"",l=(parseFloat(e.value.price)/1e6).toFixed(2),t=s.querySelector(".js-price"),t.innerText=l||"",l=r.metadata?.artifactUri,l){try{new URL(l),l=l.replace("ipfs://","https://ipfs.io/ipfs/")}catch(e){}let e=r.metadata?.mimeType;e&&e.startsWith("video")?(t=s.querySelector(".js-img"),t.parentNode.removeChild(t),t=s.querySelector(".js-audio"),t.parentNode.removeChild(t),t=s.querySelector(".js-video")):e&&e.startsWith("audio")?(t=s.querySelector(".js-img"),t.parentNode.removeChild(t),t=s.querySelector(".js-video"),t.parentNode.removeChild(t),t=s.querySelector(".js-audio")):(t=s.querySelector(".js-video"),t.parentNode.removeChild(t),t=s.querySelector(".js-audio"),t.parentNode.removeChild(t),t=s.querySelector(".js-img")),t.setAttribute("src",l),t.classList.remove("is-hidden")}let g=s.querySelector(".js-btn-buy"),y=s.querySelector(".js-btn-cancel-offer");return e.value.seller===c?(g.classList.add("is-hidden"),y.classList.remove("is-hidden"),y.addEventListener("click",(()=>async function(e){let t=event.target.closest(".js-listing"),n=await async function(e){try{let t=await o.requestOperation({operationDetails:[{kind:beacon.TezosOperationType.TRANSACTION,amount:0,destination:i,parameters:{entrypoint:"cancel_offer",value:JSON.parse('{ "int": "'+e+'" }')}}]});if(t.transactionHash)return t.transactionHash}catch(e){console.log("ERRROR cancelOffer(): "+e+" "+JSON.stringify(e))}}(e);n&&(j(n),t.remove())}(e.key)))):(y.classList.add("is-hidden"),g.classList.remove("is-hidden"),g.addEventListener("click",(()=>S(e.key,e.value.price)))),s.querySelectorAll(".js-token-item").forEach((function(e){e.setAttribute("href",a.origin+a.pathname+"?cmd=token&cid="+r.contract.address+"&tid="+r.tokenId)})),s}async function p(){g(),document.getElementById("dLastTokens").innerHTML="",document.getElementById("contentLastTokens").classList.remove("is-hidden");let e=document.getElementById("dLastTokens"),t=0,n=await async function(){try{let e=await fetch("https://api."+r+".tzkt.io/v1/tokens?sort.desc=lastActivity&select=contract,tokenId,totalSupply,metadata&metadata.artifactUri.as=data*&limit=50");if(e.ok)return await e.json();console.log("ERROR getLastTokens(): can't get tokens")}catch(e){console.log("ERRROR getLastTokens(): "+e+JSON.stringify(e))}}();for(let a of n){t++;let n=await I(a);e.append(n)}0===(E+=t)&&(e.textContent="There are no tokens yet.")}bulmaToast.setDefaults({duration:5e3,position:"bottom-left",dismissible:!0,animate:{in:"zoomIn",out:"zoomOut"}}),document.addEventListener("DOMContentLoaded",(async function(){document.getElementById("titleNetwork").innerHTML="&nbsp;"+r,await O(!0);let e=new URLSearchParams(window.location.search).get("cmd");"info"===e?await(document.getElementById("btnBurger").classList.remove("is-active"),document.getElementById("navbarMenu").classList.remove("is-active"),g(),void document.getElementById("pageInfo").classList.remove("is-hidden")):"tokens"===e?await async function(){g(),document.getElementById("dTokens").innerHTML="",document.getElementById("pageTokens").classList.remove("is-hidden");let e=new URLSearchParams(window.location.search).get("cid");if(e){w=e;let t=document.getElementById("bthNewToken"),n=await async function(e){let t="select=address,tokensCount,firstActivityTime,creator.address as creator&address="+e;try{let e=await fetch("https://api."+r+".tzkt.io/v1/contracts?"+t);if(e.ok)return await e.json();console.log("ERROR getCollection(): can't get collection")}catch(e){console.log("ERRROR getCollection(): "+JSON.stringify(e))}}(e);n&&n.length>0&&n[0].creator===c?t.classList.remove("is-hidden"):t.classList.add("is-hidden")}await b()}():"token"===e?await async function(){g();let e=document.getElementById("btnTokenBuy"),t=document.getElementById("btnTokenList");t.classList.add("is-hidden");let a=document.getElementById("btnTokenBurn");a.classList.add("is-hidden");let s=document.getElementById("btnTokenTransfer");s.classList.add("is-hidden"),document.getElementById("dToken").classList.add("is-hidden"),document.getElementById("pageToken").classList.remove("is-hidden");let o=new URL(window.location),i=new URLSearchParams(window.location.search),r=i.get("cid");r?w=r:r=w;let l=i.get("tid");l?B=l:l=B;let u,y=document.getElementById("pageToken"),f=await m(w,l);if(f){let i;L=f,f.account===c&&f.balance>0&&(t.classList.remove("is-hidden"),a.classList.remove("is-hidden"),s.classList.remove("is-hidden")),new Promise((t=>{setTimeout((()=>{t(Promise.all([d(f.token.contract.address,f.token.tokenId),e]))}),10)})).then((e=>{e[0]&&(e[1].append(document.createTextNode((parseFloat(e[0].value.price)/1e6).toFixed(2)+" êœ©")),e[1].addEventListener("click",(()=>S(e[0].key,e[0].value.price))),e[1].removeAttribute("disabled"))})),u=f.token.metadata?.name,y.querySelector(".js-name").innerText=u||"",u=f.token.metadata?.description,y.querySelector(".js-description").innerText=u||"";let r=y.querySelector(".js-creators"),l=y.querySelector(".js-creator");u=f.token.metadata?.creators;try{u=JSON.parse(u);for(let e=0;e<u.length;e++)i=l.cloneNode(!0),i.setAttribute("href",o.origin+o.pathname+"?cmd=tokens&creator="+u[e]),i.append(document.createTextNode(n(u[e]))),e>0&&r.append(document.createTextNode(", ")),i.classList.remove("is-hidden"),r.append(i)}catch(e){y.querySelector(".js-creators").innerText=""}u=f.balance,y.querySelector(".js-balance").innerText=u||"",u=f.token.totalSupply,y.querySelector(".js-editions").innerText=u||"",u=f.firstTime,y.querySelector(".js-firsttime").innerText=u?new Date(Date.parse(u)).toLocaleString():"",u=f.token.contract.address,i=y.querySelector(".js-contract"),i.setAttribute("href",o.origin+o.pathname+"?cmd=tokens&cid="+u),u?i.append(document.createTextNode(n(u))):i.innerText="",u=f.token.tokenId,y.querySelector(".js-tokenid").innerText=u||"";let m=y.querySelector(".tags"),g=m.querySelector(".tag");u=f.token.metadata?.tags;try{u=JSON.parse(u);for(let e=0;e<u.length;e++)i=g.cloneNode(!0),i.append(document.createTextNode(u[e])),i.setAttribute("href",o.origin+o.pathname+"?cmd=tokens&tag="+u[e]),i.classList.remove("is-hidden"),m.append(i)}catch(e){m.innerText=""}let p=f.token.metadata?.mimeType;if(y.querySelector(".js-type").innerText=p||"",u=f.token.metadata?.artifactUri,u){try{new URL(u),u=u.replace("ipfs://","https://ipfs.io/ipfs/")}catch(e){}p&&p.startsWith("video")?(i=y.querySelector(".js-img"),i.parentNode.removeChild(i),i=y.querySelector(".js-audio"),i.parentNode.removeChild(i),i=y.querySelector(".js-video")):p&&p.startsWith("audio")?(i=y.querySelector(".js-img"),i.parentNode.removeChild(i),i=y.querySelector(".js-video"),i.parentNode.removeChild(i),i=y.querySelector(".js-audio")):(i=y.querySelector(".js-video"),i.parentNode.removeChild(i),i=y.querySelector(".js-audio"),i.parentNode.removeChild(i),i=y.querySelector(".js-img")),i.setAttribute("src",u),i.classList.remove("is-hidden")}document.getElementById("dToken").classList.remove("is-hidden")}}():"search"===e?await async function(){g(),document.getElementById("pageSearch").classList.remove("is-hidden")}():"collections"===e?await T():"listings"===e?await async function(){g(),document.getElementById("dListings").innerHTML="",document.getElementById("pageListings").classList.remove("is-hidden"),await y()}():await p()})),document.getElementById("btnMenuExplore").addEventListener("click",(()=>async function(){window.location.search="cmd=collections"}())),document.getElementById("btnMenuSearch").addEventListener("click",(()=>async function(){window.location.search="cmd=search"}())),document.getElementById("btnMenuInfo").addEventListener("click",(()=>async function(){window.location.search="cmd=info"}())),document.getElementById("btnNetMainnet").addEventListener("click",(()=>N("mainnet"))),document.getElementById("btnNetGhostnet").addEventListener("click",(()=>N("ghostnet"))),document.getElementById("btnCopyAddress").addEventListener("click",(()=>function(){let e;c&&(e=a(c)),e&&bulmaToast.toast(u)}())),document.getElementById("btnMyCollections").addEventListener("click",(()=>async function(){window.location.search="cmd=collections&creator="+c}())),document.getElementById("btnMyTokens").addEventListener("click",(()=>async function(){window.location.search="cmd=tokens&creator="+c}())),document.getElementById("btnMyListings").addEventListener("click",(()=>async function(){window.location.search="cmd=listings&seller="+c}())),document.getElementById("btnConnect").addEventListener("click",(()=>O(!1))),document.getElementById("btnDisconnect").addEventListener("click",(()=>async function(){await async function(){await o.removeAllAccounts(),c=""}(),c||(document.getElementById("divDisconnect").classList.add("is-hidden"),document.getElementById("aAddress").innerHTML="",document.getElementById("divConnect").classList.remove("is-hidden"),g(),document.querySelectorAll(".js-loggedin").forEach((function(e){e.classList.add("is-hidden")}))),await p()}())),document.getElementById("btnSearch").addEventListener("click",(()=>async function(){let e="";if(document.getElementById("searchListTab").classList.contains("is-active")){let t,n,a=document.getElementById("searchListMinPrice").value;if(a){if(a=Math.round(parseFloat(a)*10**6),Number.isNaN(a)||a<=0)return void bulmaToast.toast({message:"Invalid min price.",type:"is-danger"});t=a,e+="&minprice="+a}if(a=document.getElementById("searchListMaxPrice").value,a){if(a=Math.round(parseFloat(a)*10**6),Number.isNaN(a)||a<=0)return void bulmaToast.toast({message:"Invalid max price.",type:"is-danger"});n=a,e+="&maxprice="+a}if(t&&n&&t>n)return void bulmaToast.toast({message:"Invalid price range.",type:"is-danger"});if(a=document.getElementById("searchListAddress").value.trim(),a){if(!s(a))return void bulmaToast.toast({message:"Invalid token or collection address.",type:"is-danger"});e+="&cid="+a}if(a=document.getElementById("searchListSeller").value.trim(),a){if(!s(a))return void bulmaToast.toast({message:"Invalid seller address.",type:"is-danger"});e+="&seller="+a}window.location.search="cmd=listings"+e}else if(document.getElementById("searchColTab").classList.contains("is-active")){let t=document.getElementById("searchColCreator").value.trim();if(t){if(!s(t))return void bulmaToast.toast({message:"Invalid creator address.",type:"is-danger"});e+="&creator="+t}window.location.search="cmd=collections"+e}else if(document.getElementById("searchTokTab").classList.contains("is-active")){let t=document.getElementById("searchTokName").value.trim();if(t){if(t.length>200)return void bulmaToast.toast({message:"The name length must be less than 200 characters.",type:"is-danger"});e+="&name="+t}t=document.getElementById("searchTokCreators").value.trim().split(/\s*,\s*/).filter((e=>e.length>0));for(let n of t){if(!s(n))return void bulmaToast.toast({message:"Invalid creator address: "+n,type:"is-danger"});e+="&creator="+n.trim()}t=document.getElementById("searchTokTags").value.trim().split(/\s*,\s*/).filter((e=>e.length>0));for(let n of t){if(n.length<3)return void bulmaToast.toast({message:"The tag length must be more than 2 characters.",type:"is-danger"});e+="&tag="+n.trim()}if(t=document.getElementById("searchTokType").value.trim(),t&&(e+="&type="+t),t=document.getElementById("searchTokMinter").value.trim(),t){if(!s(t))return void bulmaToast.toast({message:"Invalid minter address.",type:"is-danger"});e+="&minter="+t}window.location.search="cmd=tokens"+e}}())),document.getElementById("isMineCollections").addEventListener("change",(()=>function(){let e=new URL(window.location);document.getElementById("isMineCollections").checked?e.searchParams.set("creator",c):e.searchParams.get("creator")===c&&e.searchParams.delete("creator"),window.location.href=e}())),document.getElementById("btnNewCollection").addEventListener("click",(()=>async function(){g(),document.getElementById("cCreators").value=c,document.getElementById("contentNewCollection").classList.remove("is-hidden")}())),document.getElementById("btnNewCollectionCreate").addEventListener("click",(()=>async function(){let t,n=new Map;if(t=document.getElementById("cName").value.trim(),t){if(t.length>200)return void bulmaToast.toast({message:"The name length must be less than 200 characters.",type:"is-danger"});n.set("name",t)}if(t=document.getElementById("cDescription").value.trim(),t){if(t.length>2e3)return void bulmaToast.toast({message:"The description length must be less than 2000 characters.",type:"is-danger"});n.set("description",t)}if(t=document.getElementById("cSymbol").value.trim(),t&&n.set("symbol",t),t=document.getElementById("cType").value.trim(),t&&n.set("type",t),t=document.getElementById("cInterfaces").value.split(/\s*,\s*/).filter((e=>e.length>0)),t.length>0&&n.set("interfaces",t),t=document.getElementById("cAuthors").value.split(/\s*,\s*/).filter((e=>e.length>0)),t.length>0&&n.set("authors",t),t=document.getElementById("cAddresses").value.split(/\s*,\s*/).filter((e=>e.length>0)),t.length>0){for(let e of t)if(!s(e))return void bulmaToast.toast({message:"Invalid author address: "+e,type:"is-danger"});t.sort(),n.set("authoraddress",t)}if(t=document.getElementById("cCreators").value.split(/\s*,\s*/).filter((e=>e.length>0)),t.length>0){for(let e of t)if(!s(e))return void bulmaToast.toast({message:"Invalid creator address: "+e,type:"is-danger"});t.sort(),n.set("creators",t)}const a=document.getElementById("cFile").files;a.length>0&&(t=await new Promise((e=>{let t=new FileReader;t.onload=n=>e(t.result),t.readAsDataURL(a[0])})),n.set("imageUri",t));let i=await async function(t){let n=t.size>0?e(JSON.stringify(Object.fromEntries(t))):"";try{let e=await fetch("./collection02.json");if(e.ok){let t=await e.text();t&&(t=t.replaceAll("${user_address}",c),t=t.replaceAll("${metadata_content}",n));const a=await o.requestOperation({operationDetails:[{kind:beacon.TezosOperationType.ORIGINATION,balance:"0",script:JSON.parse(t)}]});if(a.transactionHash)return a.transactionHash}else console.log("ERROR createCollection(): can't create collection")}catch(e){console.log("ERRROR createCollection(): "+JSON.stringify(e))}}(n);i&&j(i)}())),document.getElementById("btnNewCollectionCancel").addEventListener("click",(()=>async function(){g(),document.getElementById("pageCollections").classList.remove("is-hidden")}())),document.getElementById("btnMoreCollections").addEventListener("click",(()=>k())),document.getElementById("btnListingsCancel").addEventListener("click",(()=>{window.history.back()})),document.getElementById("btnMoreListings").addEventListener("click",(()=>y())),document.getElementById("btnTokensCancel").addEventListener("click",(()=>async function(){window.history.back()}())),document.getElementById("bthNewToken").addEventListener("click",(()=>async function(){g(),document.getElementById("nftCreators").value=c,document.getElementById("contentNewToken").classList.remove("is-hidden")}())),document.getElementById("btnNewTokenCreate").addEventListener("click",(()=>async function(){let t,n=new Map;if(t=document.getElementById("nftName").value.trim(),t){if(t.length>200)return void bulmaToast.toast({message:"The name length must be less than 200 characters.",type:"is-danger"});n.set("name",t)}if(t=document.getElementById("nftDescription").value.trim(),t){if(t.length>200)return void bulmaToast.toast({message:"The description length must be less than 2000 characters.",type:"is-danger"});n.set("description",t)}if(t=document.getElementById("nftTags").value.trim().split(/\s*,\s*/).filter((e=>e.length>0)),t.length>0){for(let e of t)if(e.length<3)return void bulmaToast.toast({message:"The tag length must be more than 2 characters.",type:"is-danger"});t.sort(((e,t)=>e.localeCompare(t))),n.set("tags",t)}if(t=document.getElementById("nftCreators").value.trim().split(/\s*,\s*/).filter((e=>e.length>0)),t.length>0){for(let e of t)if(!s(e))return void bulmaToast.toast({message:"Invalid creator address: "+e,type:"is-danger"});t.sort(),n.set("creators",t)}t=document.getElementById("nftType").value.trim(),t&&n.set("mimeType",t),t=document.getElementById("nftRights").value.trim(),t&&n.set("rights",t),t=document.getElementById("nftDecimals").value.trim(),t&&n.set("decimals",t);let a=new Map,i=0,l=document.getElementById("contentNewToken").querySelectorAll(".js-royalties-line-data");for(let e of l){let t=e.querySelector(".js-royalties-data-address").value.trim();if(0===t.length)return void bulmaToast.toast({message:"The royalty address must not be empty.",type:"is-danger"});if(!s(t))return void bulmaToast.toast({message:"Invalid royalty address: "+t,type:"is-danger"});if(a.has(t))return void bulmaToast.toast({message:"The royalty addresses must be different.",type:"is-danger"});let n=e.querySelector(".js-royalties-data-value").value;try{n=Math.round(100*parseFloat(n))}catch(e){return void bulmaToast.toast({message:"The royalty value must be a number.",type:"is-danger"})}if(n<=0)return void bulmaToast.toast({message:"The royalty value must be greater than zero.",type:"is-danger"});if(i+=n,i>2500)return void bulmaToast.toast({message:"The maximum amount of the total royalty shall not exceed 25%.",type:"is-danger"});a.set(t,n)}a.size>0&&(t='{"decimals":4,"shares":'+JSON.stringify(Object.fromEntries(a))+"}",n.set("royalties",t));const d=document.getElementById("nftFile").files;if(!(d.length>0))return void bulmaToast.toast({message:"Media file must be selected.",type:"is-danger"});t=await new Promise((e=>{let t=new FileReader;t.onload=n=>e(t.result),t.readAsDataURL(d[0])})),n.set("artifactUri",t);let m=document.getElementById("nftEditions").value,u=await async function(t,n,a){let s="";if((a=new Map([...a].sort())).size>0){let t=0;for(let[n,o]of a)t>0&&(s+=","),t++,s+='{"prim":"Elt","args":[{"string":"'+n+'"},{"bytes":"'+e("string"==typeof o||o instanceof String?o:JSON.stringify(o))+'"}]}'}try{let e='{"prim":"Pair","args":[{"int":"'+n+'"},{"prim":"Pair","args":[['+s+'],{"string":"'+c+'"}]}]}';try{let n=await fetch("https://api."+r+".tzkt.io/v1/contracts/"+t+"/entrypoints/mint"),a=await n.json();2===Object.keys(a.jsonParameters["schema:object"]).length&&(e='{"prim":"Pair","args":[['+s+'],{"string":"'+c+'"}]}')}catch(e){}let a=await o.requestOperation({operationDetails:[{kind:beacon.TezosOperationType.TRANSACTION,amount:0,destination:t,parameters:{entrypoint:"mint",value:JSON.parse(e)}}]});if(a.transactionHash)return a.transactionHash}catch(e){console.log("ERRROR createToken(): "+e+" "+JSON.stringify(e))}}(w,m,n);u&&j(u)}())),document.getElementById("btnNewTokenCancel").addEventListener("click",(()=>async function(){g(),document.getElementById("pageTokens").classList.remove("is-hidden")}())),document.getElementById("btnMoreTokens").addEventListener("click",(()=>b())),document.getElementById("btnTokenCancel").addEventListener("click",(()=>async function(){window.history.back()}())),document.getElementById("btnTokenList").addEventListener("click",(()=>async function(){L&&document.getElementById("mListTokenAmount").setAttribute("max",L.balance),document.getElementById("mListToken").classList.add("is-active")}())),document.getElementById("btnListTokenList").addEventListener("click",(()=>async function(){if(!L)return void bulmaToast.toast({message:"The token is not found.",type:"is-danger"});let e=Math.round(parseFloat(document.getElementById("mListTokenPrice").value)*10**6);if(Number.isNaN(e)||e<=0)return void bulmaToast.toast({message:"Invalid price.",type:"is-danger"});let t,n=L.token.contract.address,a=L.token.tokenId,s=document.getElementById("mListTokenAmount").value;try{let e=JSON.parse(L.token.metadata.royalties);t=new Map(Object.entries(e.shares));let n=e.decimals;for(let[e,a]of t)t.set(e,Math.trunc(Number(a)/10**n*1e4))}catch(e){t=new Map}let r=document.getElementById("mListTokenStartTiime").value;r=Math.trunc(Date.parse(r)/1e3),r||(r=Math.trunc(Date.now()/1e3));let l=await async function(e,t,n,a,s,r,l){let d="";if(s&&s.size>0){s=new Map([...s].sort());let e=0;for(let[t,n]of s)e>0&&(d+=","),e++,d+='{"prim":"Elt","args":[{"string":"'+t+'"},{"int":"'+n+'"}]}'}l=l?'"prim":"Some","args":[{"int":"'+l+'"}]':'"prim":"None"';try{let s=await o.requestOperation({operationDetails:[{kind:beacon.TezosOperationType.TRANSACTION,amount:0,destination:t,parameters:{entrypoint:"update_operators",value:JSON.parse('[ { "prim": "Left", "args": [ { "prim": "Pair", "args": [ { "string": "'+c+'" }, { "prim": "Pair", "args": [ { "string": "'+i+'" }, { "int": "'+n+'" } ] } ] } ] } ]')}},{kind:beacon.TezosOperationType.TRANSACTION,amount:0,destination:i,parameters:{entrypoint:"add_offer",value:JSON.parse('{"prim":"Pair","args":[{"prim":"Pair","args":[{"int":"'+a+'"},{"prim":"Pair","args":[{"int":"'+e+'"},['+d+']]}]},{"prim":"Pair","args":[{'+l+'},{"prim":"Pair","args":[{"int":"'+r+'"},{"prim":"Pair","args":[{"string":"'+t+'"},{"int":"'+n+'"}]}]}]}]}')}}]});if(s.transactionHash)return s.transactionHash}catch(e){console.log("ERRROR addOffer(): "+e+" "+JSON.stringify(e))}}(e,n,a,s,t,r,"");l&&(j(l),document.getElementById("mListToken").classList.remove("is-active"))}())),document.getElementById("btnTokenBurn").addEventListener("click",(()=>async function(){L&&document.getElementById("mBurnTokenAmount").setAttribute("max",L.balance),document.getElementById("mBurnToken").classList.add("is-active")}())),document.getElementById("btnBurnTokenBurn").addEventListener("click",(()=>async function(){let e=document.getElementById("mBurnTokenAmount").value,t=await async function(e,t,n){try{let a='{"prim":"Pair","args":[{"int":"'+n+'"},{"int":"'+t+'"}]}';try{let n=await fetch("https://api."+r+".tzkt.io/v1/contracts/"+e+"/entrypoints/burn?json=false&michelson=true");(await n.json()).michelsonParameters.startsWith("pair")||(a='{"int":"'+t+'"}')}catch(e){}let s=await o.requestOperation({operationDetails:[{kind:beacon.TezosOperationType.TRANSACTION,amount:0,destination:e,parameters:{entrypoint:"burn",value:JSON.parse(a)}}]});if(s.transactionHash)return s.transactionHash}catch(e){console.log("ERRROR burnToken(): "+e+" "+JSON.stringify(e))}}(w,B,e);t&&(j(t),window.history.back())}())),document.getElementById("btnTokenTransfer").addEventListener("click",(()=>async function(){L&&document.getElementById("mTransferTokenAmount").setAttribute("max",L.balance),document.getElementById("mTransferTokenAddressTo").value="",document.getElementById("mTransferToken").classList.add("is-active")}())),document.getElementById("btnTransferTokenTransfer").addEventListener("click",(()=>async function(){let e=document.getElementById("mTransferTokenAmount").value,t=document.getElementById("mTransferTokenAddressTo").value.trim();if(!s(t))return void bulmaToast.toast({message:"Invalid destination address.",type:"is-danger"});let n=await async function(e,t,n,a){try{let s=await o.requestOperation({operationDetails:[{kind:beacon.TezosOperationType.TRANSACTION,amount:0,destination:e,parameters:{entrypoint:"transfer",value:JSON.parse('[{"prim": "Pair","args":[{"string":"'+c+'"},[{"prim": "Pair","args":[{"string":"'+a+'"},{"prim": "Pair","args":[{"int":"'+t+'"},{"int":"'+n+'"}]}]}]]}]')}}]});if(s.transactionHash)return s.transactionHash}catch(e){console.log("ERRROR transferToken(): "+e+" "+JSON.stringify(e))}}(w,B,e,t);n&&(j(n),document.getElementById("mTransferToken").classList.remove("is-active"))}())),document.querySelectorAll(".js-faq-item").forEach((function(e){e.onclick=R}));const h=15;var v=0;async function T(){g(),document.getElementById("dCollections").innerHTML="",document.getElementById("pageCollections").classList.remove("is-hidden"),await k()}async function k(){let e=document.getElementById("btnMoreCollections");e.classList.add("is-loading");let n=document.getElementById("dCollections"),a=0,s=new URLSearchParams(window.location.search).get("creator");document.getElementById("isMineCollections").checked=s===c;let o=await async function(e,t,n){let a="sort.desc=lastActivity&select=address,tokensCount,firstActivityTime,creator.address as creator&typeHash=-1889653220"+(t?"&limit="+t:"")+(n?"&offset="+n:"")+(e?"&creator="+e:"");try{let e=await fetch("https://api."+r+".tzkt.io/v1/contracts?"+a);if(e.ok)return await e.json();console.log("ERROR getCollections(): can't get collections")}catch(e){console.log("ERRROR getCollections(): "+JSON.stringify(e))}}(s,h,v);if(o)for(let e of o){a++;let s=await l(e.address);if(s)try{s=JSON.parse(t(s))}catch(e){continue}const o=document.getElementById("t-collection").content.cloneNode(!0);let i=s?.imageUri;if(i){try{new URL(i),i=i.replace("ipfs://","https://ipfs.io/ipfs/")}catch(e){}o.querySelector(".js-img").setAttribute("src",i)}o.querySelector(".js-name").innerText=s?.name,o.querySelector(".js-description").innerText=s?.description,o.querySelector(".js-address").textContent=e.address,o.querySelector(".js-count").innerText=e.tokensCount;let r=new URL(window.location);o.querySelectorAll(".js-collection-item").forEach((function(t){t.setAttribute("href",r.origin+r.pathname+"?cmd=tokens&cid="+e.address)})),n.append(o)}let i=document.getElementById("dMoreCollections");a<h?i.classList.add("is-hidden"):i.classList.remove("is-hidden"),e.classList.remove("is-loading"),0===(v+=a)&&(n.textContent="There are no collections yet.")}var E=0,w="";async function b(){let e=document.getElementById("btnMoreTokens");e.classList.add("is-loading");let t=document.getElementById("dTokens"),n=0,a=new URLSearchParams(window.location.search),s=await async function(e,t,n,a,s,o,i,c){let l="sort.desc=id&select=contract,tokenId,totalSupply,metadata&limit=20"+(t?"&offset="+t:"")+(n?"&contract.in="+n:"")+(c?"&firstMinter="+c:"")+(a?"&metadata.name="+a:"")+"&metadata.artifactUri.as=data:"+(i||"")+"*";if(s&&s.length>0){s.sort(),l+="&metadata.creators.as=*";for(let e of s)l+='"'+e+'"*'}if(o&&o.length>0){o.sort(((e,t)=>e.localeCompare(t))),l+="&metadata.tags.as=*";for(let e of o)l+='"'+e+'"*'}try{let e=await fetch("https://api."+r+".tzkt.io/v1/tokens?"+l);if(e.ok)return await e.json();console.log("ERROR getTokens(): can't get tokens")}catch(e){console.log("ERRROR getTokens(): "+JSON.stringify(e))}}(0,E,a.get("cid"),a.get("name"),a.getAll("creator"),a.getAll("tag"),a.get("type"),a.get("minter"));for(let e of s){n++;let a=await I(e);t.append(a)}let o=document.getElementById("dMoreTokens");n<20?o.classList.add("is-hidden"):o.classList.remove("is-hidden"),e.classList.remove("is-loading"),0===(E+=n)&&(t.textContent="There are no tokens yet.")}async function I(e){let t,a=new URL(window.location);const s=document.getElementById("t-token").content.cloneNode(!0);let o=s.querySelector(".js-price");new Promise((t=>{setTimeout((()=>{t(Promise.all([d(e.contract.address,e.tokenId),o]))}),10)})).then((e=>{e[0]&&(e[1].innerText=(parseFloat(e[0].value.price)/1e6).toFixed(2),e[1].parentNode.classList.remove("is-hidden"))}));let i=e.metadata?.name;t=s.querySelector(".js-name"),t.innerText=i||"";let r=s.querySelector(".js-creators"),c=s.querySelector(".js-creator");i=e.metadata?.creators;try{i=JSON.parse(i);for(let e=0;e<i.length;e++)t=c.cloneNode(!0),t.setAttribute("href",a.origin+a.pathname+"?cmd=tokens&creator="+i[e]),t.append(document.createTextNode(n(i[e]))),e>0&&r.append(document.createTextNode(", ")),t.classList.remove("is-hidden"),r.append(t)}catch(e){s.querySelector(".js-creators").innerText=""}if(i=e.totalSupply,t=s.querySelector(".js-count"),t.innerText=i||"",i=e.metadata?.artifactUri,i){try{new URL(i),i=i.replace("ipfs://","https://ipfs.io/ipfs/")}catch(e){}let n=e.metadata?.mimeType;n&&n.startsWith("video")?(t=s.querySelector(".js-img"),t.parentNode.removeChild(t),t=s.querySelector(".js-audio"),t.parentNode.removeChild(t),t=s.querySelector(".js-video")):n&&n.startsWith("audio")?(t=s.querySelector(".js-img"),t.parentNode.removeChild(t),t=s.querySelector(".js-video"),t.parentNode.removeChild(t),t=s.querySelector(".js-audio")):(t=s.querySelector(".js-video"),t.parentNode.removeChild(t),t=s.querySelector(".js-audio"),t.parentNode.removeChild(t),t=s.querySelector(".js-img")),t.setAttribute("src",i),t.classList.remove("is-hidden")}return s.querySelectorAll(".js-token-item").forEach((function(t){t.setAttribute("href",a.origin+a.pathname+"?cmd=token&cid="+e.contract.address+"&tid="+e.tokenId)})),s}var L,B="";async function S(e,t){let n=await async function(e,t,n){try{let t=await o.requestOperation({operationDetails:[{kind:beacon.TezosOperationType.TRANSACTION,amount:1*n,destination:i,parameters:{entrypoint:"accept_offer",value:JSON.parse('{"prim":"Pair","args":[{"int":"1"},{"int":"'+e+'"}]}')}}]});if(t.transactionHash)return t.transactionHash}catch(e){console.log("ERRROR buyToken(): "+e+" "+JSON.stringify(e))}}(e,0,t);n&&j(n)}function R(){let e=event.currentTarget.querySelector(".fas");event.currentTarget.parentElement.querySelector(".is-collapsible").classList.toggle("is-active"),e.classList.toggle("fa-angle-down"),e.classList.toggle("fa-angle-up")}async function N(e){var t;document.querySelectorAll(".has-dropdown").forEach((function(e){e.classList.remove("is-hoverable"),setTimeout((function(){e.classList.add("is-hoverable")}),100)})),e!==r&&(r!==(t=e)&&(r=t,o.network={type:r},console.log("dAppClient.network="+o.network.type)),document.getElementById("titleNetwork").innerHTML="&nbsp;"+r,await T())}async function O(e){await async function(e){let t=await o.getActiveAccount();if(t)c=t.address;else if(!e){let e=await o.requestPermissions({network:{type:r}});c=e.address}}(e),c?(document.getElementById("divConnect").classList.add("is-hidden"),document.getElementById("aAddress").innerHTML=n(c),document.getElementById("divDisconnect").classList.remove("is-hidden"),document.querySelectorAll(".js-loggedin").forEach((function(e){}))):document.querySelectorAll(".js-loggedin").forEach((function(e){e.classList.add("is-hidden")}))}function j(e){bulmaToast.toast({message:"Your request is processing with ID <a href='https://"+r+".tzkt.io/"+e+"' target='_blank'>"+n(e)+"</a>",duration:5e3,type:"is-success"})}LT={}})();