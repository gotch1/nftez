var LT;(()=>{"use strict";function e(e){return Array.from((new TextEncoder).encode(e),(e=>e.toString(16).padStart(2,"0"))).join("")}function t(e){const t=new Uint8Array(e.length/2);for(let n=0;n!==t.length;n++)t[n]=parseInt(e.substr(2*n,2),16);return(new TextDecoder).decode(t)}function n(e){return e&&e.length>14?e.substring(0,7)+"..."+e.substring(e.length-4):e}const s="ghostnet",o="https://api."+s+".tzkt.io/v1/",i=new beacon.DAppClient({name:"NFTez"});let c="";async function a(e){try{let t=await fetch(o+"contracts/"+e+"/bigmaps/metadata/keys?key=content&select=value&select=address,tokensCount,firstActivityTime");if(t.ok)return(await t.json())[0];console.log("ERROR getCollection(): can't get collection")}catch(e){console.log("ERRROR getCollection(): "+JSON.stringify(e))}}const l={message:"The address is copied",type:"is-success"};async function r(){document.querySelectorAll(".js-page").forEach((function(e){e.classList.add("is-hidden")}));let e=document.getElementById("dCollections");e.innerHTML="",document.getElementById("contentCollections").classList.remove("is-hidden");let n=0,s=await async function(){try{let e=await fetch(o+"contracts?tzip=fa2&sort.desc=id&creator="+c+"&select=address,tokensCount,firstActivityTime");if(e.ok)return await e.json();console.log("ERROR getCollections(): can't get collections")}catch(e){console.log("ERRROR getCollections(): "+JSON.stringify(e))}}();if(s)for(let o of s){n++;let s=await a(o.address);s&&(s=JSON.parse(t(s)));const i=document.getElementById("t-collection").content.cloneNode(!0);let c=s?.imageUri;if(c){try{new URL(c),c=c.replace("ipfs://","https://ipfs.io/ipfs/")}catch(e){}i.querySelector(".js-img").setAttribute("src",c)}i.querySelector(".js-name").innerHTML=s?.name,i.querySelector(".js-address").textContent=o.address,i.querySelector(".js-description").innerText=s?.description,i.querySelector(".js-date").innerText=new Date(Date.parse(o.firstActivityTime)).toLocaleString(),i.querySelector(".js-count").innerText=o.tokensCount,i.querySelectorAll(".js-collection-item").forEach((function(e){e.classList.add("is-clickable"),e.addEventListener("click",(()=>u(o.address)))})),e.append(i)}0===n&&(e.textContent="There are no collections yet.")}bulmaToast.setDefaults({duration:5e3,position:"bottom-left",dismissible:!0,animate:{in:"zoomIn",out:"zoomOut"}}),document.addEventListener("DOMContentLoaded",(async function(){document.getElementById("titleNetwork").innerHTML="&nbsp;"+s,await g(!0)})),document.getElementById("btnCopyAddress").addEventListener("click",(()=>function(){let e;c&&(e=f(c)),e&&bulmaToast.toast(l)}())),document.getElementById("btnConnect").addEventListener("click",(()=>g(!1))),document.getElementById("btnDisconnect").addEventListener("click",(()=>async function(){await async function(){await i.removeAllAccounts(),c=""}(),c||(document.getElementById("divDisconnect").classList.add("is-hidden"),document.getElementById("aAddress").innerHTML="",document.getElementById("divConnect").classList.remove("is-hidden"),document.querySelectorAll(".js-page").forEach((function(e){e.classList.add("is-hidden")})),document.getElementById("contentIntro").classList.remove("is-hidden"))}())),document.getElementById("btnNewCollection").addEventListener("click",(()=>async function(){document.querySelectorAll(".js-page").forEach((function(e){e.classList.add("is-hidden")})),document.getElementById("contentCollection").classList.remove("is-hidden")}())),document.getElementById("btnNewCollectionCreate").addEventListener("click",(()=>async function(){let t,n=new Map;t=document.getElementById("cName").value.trim(),t&&n.set("name",t),t=document.getElementById("cDescription").value.trim(),t&&n.set("description",t),t=document.getElementById("cSymbol").value.trim(),t&&n.set("symbol",t),t=document.getElementById("cType").value.trim(),t&&n.set("type",t),t=document.getElementById("cInterfaces").value.split(/\s*,\s*/).filter((e=>e.length>0)),t.length>0&&n.set("interfaces",t),t=document.getElementById("cAuthors").value.split(/[ ,]+/).filter((e=>e.length>0)),t.length>0&&n.set("authors",t),t=document.getElementById("cAddresses").value.split(/[ ,]+/).filter((e=>e.length>0)),t.length>0&&n.set("authoraddress",t),t=document.getElementById("cCreators").value.split(/[ ,]+/).filter((e=>e.length>0)),t.length>0&&n.set("creators",t);const s=document.getElementById("cFile").files;s.length>0&&(t=await new Promise((e=>{let t=new FileReader;t.onload=n=>e(t.result),t.readAsDataURL(s[0])})),n.set("imageUri",t));let o=await async function(t){let n=t.size>0?e(JSON.stringify(Object.fromEntries(t))):"";try{let e=await fetch("./collection.json");if(e.ok){let t=await e.text();t&&(t=t.replaceAll("${user_address}",c),t=t.replaceAll("${metadata_content}",n));const s=await i.requestOperation({operationDetails:[{kind:beacon.TezosOperationType.ORIGINATION,balance:"0",script:JSON.parse(t)}]});if(s.transactionHash)return s.transactionHash}else console.log("ERROR createCollection(): can't create collection")}catch(e){console.log("ERRROR createCollection(): "+JSON.stringify(e))}}(n);o&&y(o)}())),document.getElementById("btnNewCollectionCancel").addEventListener("click",(()=>async function(){await r()}())),document.getElementById("bthNewNFT").addEventListener("click",(()=>async function(){document.querySelectorAll(".js-page").forEach((function(e){e.classList.add("is-hidden")})),document.getElementById("contentNFT").classList.remove("is-hidden")}())),document.getElementById("btnNFTsCancel").addEventListener("click",(()=>async function(){await r()}())),document.getElementById("btnNewNFTCreate").addEventListener("click",(()=>async function(){let t,n=new Map;t=document.getElementById("nftName").value.trim(),t&&n.set("name",t),t=document.getElementById("nftDescription").value.trim(),t&&n.set("description",t),t=document.getElementById("nftTags").value.split(/\s*,\s*/).filter((e=>e.length>0)),t.length>0&&n.set("tags",t),t=document.getElementById("nftAuthors").value.split(/[ ,]+/).filter((e=>e.length>0)),t.length>0&&n.set("authors",t),t=document.getElementById("nftAddresses").value.split(/[ ,]+/).filter((e=>e.length>0)),t.length>0&&n.set("authoraddress",t),t=document.getElementById("nftCreators").value.split(/[ ,]+/).filter((e=>e.length>0)),t.length>0&&n.set("creators",t),t=document.getElementById("nftType").value.trim(),t&&n.set("mimeType",t),t=document.getElementById("nftDecimals").value.trim(),t&&n.set("decimals",t),t=document.getElementById("nftRoyalties").value.trim(),t&&n.set("royalties",t),t=document.getElementById("nftRights").value.trim(),t&&n.set("rights",t);const s=document.getElementById("nftFile").files;s.length>0&&(t=await new Promise((e=>{let t=new FileReader;t.onload=n=>e(t.result),t.readAsDataURL(s[0])})),n.set("artifactUri",t));let o=await async function(t,n){let s="";if((n=new Map([...n].sort()))&&n.size>0){let t=0;for(let[o,i]of n)t>0&&(s+=","),s+='{"prim":"Elt","args":[{"string":"'+o+'"},{"bytes":"'+e("string"==typeof i||i instanceof String?i:JSON.stringify(i))+'"}]}',t++}try{let e=await i.requestOperation({operationDetails:[{kind:beacon.TezosOperationType.TRANSACTION,amount:0,destination:t,parameters:{entrypoint:"mint",value:JSON.parse('{"prim":"Pair","args":[['+s+'],{"string":"'+c+'"}]}')}}]});if(e.transactionHash)return e.transactionHash}catch(e){console.log("ERRROR createNFT(): "+e+" "+JSON.stringify(e))}}(d,n);o&&y(o)}())),document.getElementById("btnNewNFTCancel").addEventListener("click",(()=>async function(){await u()}())),document.querySelectorAll(".js-faq-item").forEach((function(e){e.onclick=m}));var d="";async function u(e){e?d=e:e=d,document.querySelectorAll(".js-page").forEach((function(e){e.classList.add("is-hidden")}));let t=document.getElementById("dNFTs");t.innerHTML="",document.getElementById("contentNFTs").classList.remove("is-hidden");let n=0,s=await async function(e){try{let t=await fetch(o+"tokens?sort.desc=id&select=tokenId,firstTime,totalSupply,metadata&contract="+e);if(t.ok)return await t.json();console.log("ERROR getNFTs(): can't get NFTs")}catch(e){console.log("ERRROR getNFTs(): "+JSON.stringify(e))}}(e);if(s)for(let e of s){n++;let s=e.metadata,o=s?.artifactUri;if(o)try{new URL(o),o=o.replace("ipfs://","https://ipfs.io/ipfs/")}catch(e){}const i=document.getElementById("t-nft").content.cloneNode(!0);i.querySelector(".js-img").setAttribute("src",o),i.querySelector(".js-name").innerHTML=s?.name,i.querySelector(".js-description").innerHTML=s?.description,i.querySelector(".js-date").innerText=new Date(Date.parse(e.firstTime)).toLocaleString(),t.append(i)}0===n&&(t.textContent="There are no NFTs yet.")}function m(){let e=event.currentTarget.querySelector(".fas");event.currentTarget.parentElement.querySelector(".is-collapsible").classList.toggle("is-active"),e.classList.toggle("fa-angle-down"),e.classList.toggle("fa-angle-up")}async function g(e){await async function(e){let t=await i.getActiveAccount();if(t)c=t.address;else if(!e){let e=await i.requestPermissions({network:{type:s}});c=e.address}}(e),c?(document.getElementById("divConnect").classList.add("is-hidden"),document.getElementById("aAddress").innerHTML=n(c),document.getElementById("divDisconnect").classList.remove("is-hidden"),await r()):document.getElementById("contentIntro").classList.remove("is-hidden")}function y(e){bulmaToast.toast({message:"Your request is processing with ID <a href='https://"+s+".tzkt.io/"+e+"' target='_blank'>"+n(e)+"</a>",duration:5e3,type:"is-success"})}function f(e){if(navigator.clipboard)return navigator.clipboard.writeText(e).then((function(){}),(function(e){return console.log("ERROR copyToClipboard(): "+e),!1})),!0;let t;var n=document.createElement("textarea");n.value=e,n.style.top="0",n.style.left="0",n.style.position="fixed",document.body.appendChild(n),n.focus(),n.select();try{document.execCommand("copy"),t=!0}catch(e){console.log("ERROR copyToClipboard(): "+e)}return document.body.removeChild(n),t}LT={}})();